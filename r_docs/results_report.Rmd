---
title: "Results Notebook"
floatsintext : yes
output:
  bookdown::html_document2:
    toc: true
    toc_depth: 2
    toc_float: true
    highlight: pygments
    code_folding: hide
  html_notebook:
    toc: yes
    toc_float: yes
    toc_depth: 5
    code_folding: hide
    number_sections: yes
    fig_caption: yes
---
<style type="text/css">
  body{
  font-family: Times New Roman;
  font-size: 12pt;
}
</style>

```{r setup-chunk, include = FALSE}
rmd_packages <- c("ggplot2", "papaja", "tidyverse", "kableExtra", "codebook", "ggpubr", "here")
lapply(rmd_packages, require, character.only = TRUE)
source("01_main_analysis.R")
load(here("figures/exp_plots.RData"))
load(here("data/exp_results.RData"))
load(here("data/unregistered.RData"))

knitr::opts_chunk$set(echo=F, warning = F, message = F, results = "asis", fig.path = "../figures/")
options(knitr.kable.NA = '')
```

# Overview {.tabset .tabset-pills}

## Data inspection

```{r histograms, out.width="50%"}
hist(clean$AGE, main="Distribution of Age", xlab ="Age")
hist(clean$POLITICS, main="Distribution of Political Position", xlab = "Political Position")
```

## Participants

A total of `r nrow(export)` participants were recruited through a survey posted on Prolific. `r sum(is.na(export$DQInclude))` were excluded as they did not complete the survey, and  `r table(export$VEG)[1]` were excluded as they are vegan/vegetarian,  and `r table(raw$DQInclude)[2]` were excluded for indicating that their results should not be included in the analysis. `r sum(raw$INTENT_QUALITY != 6 & raw$DQInclude == 1)` were excluded for failing to select the correct response in an attention check. The final sample (*N* = `r nrow(clean)`) ranged in age `r age_desc[1]` to `r age_desc[2]` (*Mdn~age~* = `r papaja::printnum(median(clean$AGE))`, *M~age~* = `r papaja::printnum(age_desc[3])`, *SD* = `r papaja::printnum(age_desc[4])`). The participants were predominantly female (`r papaja::printnum(gender_freq[2])`%). The participants received £0.35 ($0.45) for successfully completing the task.

## Randomization check

A preliminary randomization check was conducted. The check revealed no systematic differences between the three conditions in gender, age, political position, and nationality (all *p*’s > .05).

```{r rand-check}
as_tibble(random_check, .name_repair = "unique") %>%
  kable(escape = F, col.names = c("Item", "Dynamic", "Static", "No norm", "Significance test"),
            caption="Randomisation check") %>%
  kable_styling()
```

## Correlations

```{r correlations-table}
kable(measure.tib, caption = "Means, Standard Deviations, Reliabilities, and Inter-Correlations Among Study Measures") %>%
  kable_styling()
```

***

# Confirmatory analyses

## Does making dynamic norms about reduced meat consumption in the UK salient lead to higher interest in reducing meat consumption (compared to static norm salience)? {.tabset .tabset-fade .tabset-pills}

### Prior

Sparkman and Walton (2017) found effects of dynamic norms on interest in reducing meat consumption ranging from *M~diff~* = 0.60 – 0.78. Thus, the rough mean difference between dynamic and static norms expected in the sample is 0.69 on a 7 point Likert scale. Thus, I modeled H1 as a half-normal with an SD of 0.69. The plausible maximum effect was set at 1.38.

### Results

The mean interest for participants in the dynamic norm condition was *M* = `r papaja::printnum(outcomes_desc[[1,3]])` (*SD* = `r papaja::printnum(outcomes_desc[[1,4]])`), and the mean interest in the static norm condition was *M* = `r papaja::printnum(outcomes_desc[[2,3]])` (*SD* = `r papaja::printnum(outcomes_desc[[2,4]])`). The mean interest in the no norm condition was *M* = `r papaja::printnum(outcomes_desc[[3,3]])` (*SD* = `r papaja::printnum(outcomes_desc[[3,4]])`).

There was no difference in interest in reducing meat consumption between the dynamic norm (*M* = `r papaja::printnum(outcomes_desc[[1,3]])`, *SD* = `r papaja::printnum(outcomes_desc[[1,4]])`) and static norm (*M* = `r papaja::printnum(outcomes_desc[[2,3]])`, *SD* = `r papaja::printnum(outcomes_desc[[2,4]])`) conditions, `r ls_interest$full_result$DYST`, *d* = `r H1.effect$DYST$d`, $B_{\text{HN}(0, 0.69)}$ = `r papaja::printnum(H1.effect$DYST.Bf)`, RR[`r H1.effect$rr$RR$sd[1]`, `r H1.effect$rr$RR$sd[2]`].

Participants in the no-norm control condition showed the least interest in reducing meat consumption (*M* = `r papaja::printnum(outcomes_desc[[3,3]])`, *SD* = `r papaja::printnum(outcomes_desc[[3,4]])`) and did not differ from those in the dynamic-norm condition `r ls_interest$full_result$DYNO`, *d* = `r H1.effect$DYNO$d`, or the static-norm condition `r ls_interest$full_result$STNO`, *d* = `r H1.effect$STNO$d`. There was also no difference between the dynamic-norm condition and a combination of the control and static-norm conditions `r ls_interest$full_result$DYCONT`. 

```{r h1-table, results='markup'}
apa_table(ls_interest$table, caption = "Meat consumption by condition contrasts", escape = F, row.names = F)
```

### Wordcloud

```{r wordcloud-fig, fig.show='asis', fig.cap="World cloud of participants response to text"}
comb_cloud <- rquery.wordcloud(comb_text, type ="text", lang = "english", min.freq = 5, excludeWords = c("reasons", "eating", "also", "meat", "people", "think", "much", "become", "due", "lot", "less", "eat", "consumption"))
```

```{r wordcloud-table}
cloud_freq <- head(comb_cloud$freqTable, 10)
apa_table(cloud_freq, caption = "Most frequent words in text", escape = F, row.names = F)
```

***

## Will participants in the dynamic norm condition be more likely (than those in the static norm control) to predict a future decrease in meat consumption in the UK?  {.tabset .tabset-pills} 

I modeled H2 using a half-normal distribution with a mean of 0 and SD of *M~diff~* = 0.40. The plausible maximum effect was set at twice the predicted effect of *M~diff~* = 0.80. A Bayes factor was calculated for each test. 

```{r h2-table}
kable(future, caption = "Expectations of future meat consumption", digits = 2, col.names = c("Condition", "$n$", rep(c("$M$", "$SD$"), 3))) %>%
  kable_styling() %>%
  add_header_above(c(" " = 2, "Future Norm" = 2, "Preconformity" = 2, "Combined" = 2))
```

***

### Measure of perception of change

>"In the next 5 years, I expect meat consumption in the UK to…"

There was no evidence one way or another for an effect of dynamic norm condition on expectations about future meat consumption, `r ls_change$full_result$DYST`, *d* = `r H2change.effect$DYST$d`, $B_{\text{HN}(0, 0.40)}$ = `r papaja::printnum(H2change.effect$DYST.Bf)`, RR[`r H2change.effect$rr$RR$sd[1]`, `r H2change.effect$rr$RR$sd[2]`]

```{r h2-percept-table}
kable(ls_change$table, caption = "Contrasts between conditions in expectations about future meat consumption", escape = F, row.names = F) %>%
  kable_styling()
```

### Measure of preconformity

>"In the foreseeable future, to what extent do you think that many people will make an effort to eat less meat?"

There was no evidence one way or the other for there being a difference in anticipation that many people would make an effort to reduce their meat consumption in the future between the dynamic norm (*M* = `r papaja::printnum(future[[1,5]])`, *SD* = `r papaja::printnum(future[[1,6]])`) and static norm (*M* = `r papaja::printnum(future[[2,5]])`, *SD* = `r papaja::printnum(future[[2,6]])`) conditions, `r ls_preconformity$full_result$DYST`, *d* = `r H2preconformity.effect$DYST$d`, $B_{\text{HN}(0, 0.40)}$ = `r papaja::printnum(H2preconformity.effect$DYST.Bf)`, RR[`r H2preconformity.effect$rr$RR$sd[1]`, `r H2preconformity.effect$rr$RR$sd[2]`].

```{r h2-preconformity-table}
kable(ls_preconformity$table, caption = "Contrasts between conditions in preconformity", escape = F, row.names= F) %>%
  kable_styling()
```

### Combined

There was no evidence one way or the other for there being a difference in anticipation that many people would make an effort to reduce their meat consumption in the future between the dynamic norm (*M* = `r papaja::printnum(future[[1,7]])`, *SD* = `r papaja::printnum(future[[1,8]])`) and static norm (*M* = `r papaja::printnum(future[[2,7]])`, *SD* = `r papaja::printnum(future[[2,8]])`) conditions, `r ls_comb_future$full_result$DYST`, *d* = `r H2comb_future.effect$DYST$d`, $B_{\text{HN}(0, 0.40)}$ = `r papaja::printnum(H2comb_future.effect$DYST.Bf)`, RR[`r H2comb_future.effect$rr$RR$sd[1]`, `r H2comb_future.effect$rr$RR$sd[2]`].

```{r h2-combined-table}
kable(ls_comb_future$table, caption = "Combined contrasts", escape = F, row.names = F) %>%
  kable_styling()
```

# Secondary analyses

## Will there be a difference in perceptions of current static norm across the dynamic and static norm conditions? 

The SESOI for percentage difference is ± 5%. The SESOI for mean difference on the Likert scale is ± 0.5.

```{r perception-TOST}
TOSTtwo.sci(m1 = secondary[[1,4]], m2 = secondary[[2,4]], sd1 = secondary[[1,6]], sd2 = secondary[[2,6]], n1 = secondary[[1,2]], n2 = secondary[[2,2]], low_eqbound = -5, high_eqbound = 5, plot = F)
```

***

## Will there be a difference in how meat consumption is construed across the dynamic and static norm conditions? 

The SESOI for difference in number of meals is ± 2 meals.

```{r construal-TOST}
TOSTtwo.sci(m1 = secondary[[1,7]], m2 = secondary[[2,7]], sd1 = secondary[[1,8]], sd2 = secondary[[2,8]], n1 = secondary[[1,2]], n2 = secondary[[2,2]], low_eqbound = -5, high_eqbound = 5, plot = F)
```

***

# Exploratory analyses

## Does dynamic norm (versus static norm) information lead to more positive attitudes, intentions, and expectations to reduce meat consumption? {.tabset .tabset-pills}

### Trace plots

```{r h3-trace, fig.show='asis', fig.cap="Traceplots of parameters estimated in the simple path model"}
h3.traceplots[[1]] + ggtitle("Uninformative")
h3.traceplots[[2]] + ggtitle("Weak prior")
h3.traceplots[[1]] + ggtitle("Moderate prior")
```

### Posterior plots

```{r h3-intervals, fig.show='asis', fig.cap="Posterior uncertainty intervals"}
h3_intervals.plot
```


```{r h3-density, fig.show='asis', fig.cap="Posterior density plot"}
h3_density.grid
```

### Summary table
    
```{r h3-table}
h3.table %>%
  kable(format = "html", caption = "Posterior results for simple model (H3)", escape = F) %>% 
  add_header_above(c(" " = 1, "Model 1: Uninformative priors$^a$" = 5, "Model 2: Weakly informative priors$^b$" = 6, "Model 3: Moderately informative priors$^c$" = 6)) %>%
  kable_styling() %>%
  footnote(general_title = "Note.",
           general = "PPI = posterior probability interval; PSRF = potential scale reduction factor; neff = effective sample size",
           alphabet = c(paste0("ppp = ", printp(h3.global[[1]][[3]])), paste0("ppp = ", printp(h3.global[[2]][[3]])), paste0("ppp = ", printp(h3.global[[3]][[3]]))), 
           footnote_as_chunk = T) %>%
  landscape()
```


***

## Does age interact with norm condition to influence dependent variables? {.tabset .tabset-pills}

### Trace plots

```{r h4-trace, fig.show='asis', fig.cap="Traceplots of parameters estimated in the multi-sample analysis "}
h4.traceplots[[1]] + ggtitle("Uninformative")
h4.traceplots[[2]] + ggtitle("Weak prior")
h4.traceplots[[1]] + ggtitle("Moderate prior")
```

### Posterior plots

```{r h4-intervals, fig.show='asis', fig.cap="Posterior uncertainty intervals"}
h4_intervals.plot
```

### Summary table (groups)

```{r interaction-table}
interact.table %>% 
  kable(format = "html", caption = "Posterior results for multi-sample analysis by age groups (H4)", row.names = F, escape = F) %>%
  add_header_above(c(" " = 1, "Model 1: Uninformative priors$^a$" = 5, "Model 2: Informative priors$^b$" = 6, "Model 3: Informative priors$^c$" = 6)) %>%  
  kable_styling() %>%
  pack_rows("Young adults", 1, 3) %>%
  pack_rows("Middle-aged adults", 4, 6) %>%
  pack_rows("Old adults", 7, 9) %>%
  footnote(general_title = "Note.",
           general = "PPI = posterior probability interval; PSRF = potential scale reduction factor; neff = effective sample size",
           alphabet = c(paste0("ppp = ", printp(h4.global[[1]][["ppp"]])), 
                        paste0("ppp = ", printp(h4.global[[2]][["ppp"]])), 
                        paste0("ppp = ", printp(h4.global[[3]][["ppp"]]))),
           footnote_as_chunk = T) %>%
  landscape()
```

### Summary table (continuous)

```{r interactioncont-table}
continuous_mod.out[,1] <- rep(c("Condition", "Age", "Condition $\\times$ Age"), 3)

continuous_mod.out %>% 
  kable(caption = "Posterior results for moderation model using age as continuous variable (H4)", 
        col.names = c("Parameter","$M$", "$SD$", "Lower PPI", "Higher PPI", "PSRF", "neff", "Prior"), row.names = F, escape = F) %>%
  kable_styling() %>%
  pack_rows("Interest", 1, 3) %>%
  pack_rows("Attitudes", 4, 6) %>%
  pack_rows("Intentions/Expectations", 7, 9) 
```



***

## Do demographic factors such as age, gender, and political position predict the primary dependent variables? {.tabset .tabset-pills}

### Trace plots

```{r h5-trace, fig.show='asis', fig.cap="Traceplots of parameters estimated in the full path model"}
h5.traceplots[[1]] + ggtitle("Uninformative")
h5.traceplots[[2]] + ggtitle("Weak prior")
h5.traceplots[[1]] + ggtitle("Moderate prior")
```

### Posterior plots

```{r h5-intervals, fig.show='asis', fig.cap="Posterior uncertainty intervals"}
h5_intervals.plot
```

```{r h5-density, fig.show='asis', fig.cap="Posterior density plot"}
h5_density.plot
```

### Summary table

```{r full-table}
h5.table %>% 
  kable(format = "html", caption = "Posterior results for full model (H5)", row.names = F, escape = F) %>%
  kable_styling() %>%
  add_header_above(c(" " = 1, "Model 1: Uninformative priors$^a$" = 5, "Model 2: Informative priors$^b$" = 6, "Model 3: Informative priors$^c$" = 6)) %>%
  pack_rows("Interest", 1, 4) %>%
  pack_rows("Attitudes", 5, 8) %>%
  pack_rows("Intention/Expectations", 9, 12) %>%
  footnote(general_title = "Note.",
           general = "PPI = posterior probability interval; PSRF = potential scale reduction factor; neff = effective sample size",
           alphabet = c(paste0("ppp = ", printp(h5.global[[1]][["ppp"]])), 
                        paste0("ppp = ", printp(h5.global[[2]][["ppp"]])), 
                        paste0("ppp = ", printp(h5.global[[3]][["ppp"]]))), footnote_as_chunk = T) %>%
  landscape()
```




***


***

# Unregistered analyses {.tabset .tabset-pills}

## Power test

Sparkman and Walton (2017) found standardized effects of dynamic norms on interest in reducing meat consumption ranging from $d$ = 0.31 – 0.41. To detect the average effect of $d$ = 0.36, we would need 122 participants in each condition.

```{r power-test}
h1.pwr
```


## Moderation of demographic variables

```{r moderation-attit}
attitude_mod.out$table <- attitude_mod.out$table %>%
  mutate(predictor = c("Intercept", "Condition", "Gender", "Political position", "Condition $\\times$ Gender", "Condition $\\times$ Political position"),
         rownames = NULL)
apa_table(attitude_mod.out$table, caption = "Exploring moderation of demographic variables on attitude", escape = F)
```

```{r moderation-intentexp}
intent_mod.out$table <- intent_mod.out$table %>%
  mutate(predictor = c("Intercept", "Condition", "Gender", "Political position", "Condition $\\times$ Gender", "Condition $\\times$ Political position"),
         rownames = NULL)
apa_table(intent_mod.out$table, caption = "Exploring moderation of demographic variables on intentions/expectations", escape = F)
```

```{r moderation-interest}
apa_table(demoreg.out$table, caption = "Exploring moderation of demographic variables on interest", escape = F)
```

## Mediation

```{r mediation}
kable(med.table, escape = F, col.names = c("Parameter", "$M$", "$SD$", "Lower PPI", "Upper PPI", "PSRF", "Prior"), caption="Exploring mediating effect of attitude on intentions/expectations") %>%
  kable_styling()
```

***

# Environment and data

## Session information
```{r session-info, results='markup'}
devtools::session_info()
```

## Codebook
```{r codebook, results='markup'}
codebook::compact_codebook(clean) 
```

